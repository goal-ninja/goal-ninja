<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="../icons/apple-touch-icon.png?v=2">
    <title>Goal Ninja - Screen Gallery</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0a0a;
            --card-bg: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #999999;
            --text-muted: #666666;
            --accent: #E67E22;
            --border: #2a2a2a;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.5;
            padding: 40px 20px 80px;
        }
        .container { max-width: 1200px; margin: 0 auto; }

        /* Header */
        .header { text-align: center; margin-bottom: 48px; }
        .header h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .header h1 span { color: var(--accent); }
        .header .subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }
        .back-link:hover { color: #ffffff; }
        .back-link svg { width: 16px; height: 16px; }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .tab-btn {
            padding: 10px 20px;
            border: 2px solid var(--border);
            border-radius: 100px;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn:hover { border-color: #ffffff; color: #ffffff; }
        .tab-btn.active {
            background: #ffffff;
            border-color: #ffffff;
            color: #0a0a0a;
        }

        /* Section */
        .section { margin-bottom: 56px; }
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .section-title {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
        }
        .screen-count {
            display: inline-block;
            background: var(--accent);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 20px;
        }
        .flow-line {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--text-muted);
            margin-left: auto;
        }
        .flow-line svg { width: 14px; height: 14px; }

        /* Screen Grid */
        .screens-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 24px;
        }
        .screens-grid.wide {
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        }

        /* Screen Card */
        .screen-card {
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }
        .screen-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.4);
        }

        /* Phone Frame */
        .phone-frame {
            position: relative;
            width: 100%;
            aspect-ratio: 9 / 19.5;
            overflow: hidden;
            background: #111111;
            border-bottom: 1px solid var(--border);
        }
        .phone-frame iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 390px;
            height: 844px;
            transform-origin: top left;
            border: none;
            pointer-events: none;
        }

        /* Screen Label */
        .screen-label {
            padding: 12px 16px;
        }
        .screen-number {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent);
            margin-bottom: 2px;
        }
        .screen-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .screen-desc {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        /* Onboarding flow arrow connector */
        .flow-arrow {
            display: none;
        }

        /* Loading state */
        .phone-frame::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            z-index: 1;
        }
        .phone-frame.loaded::before { display: none; }
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            body { padding: 24px 12px 60px; }
            .header h1 { font-size: 28px; }
            .screens-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            .screen-label { padding: 10px 12px; }
            .screen-name { font-size: 13px; }
        }

        /* Section visibility for tabs */
        .section[data-tab] { display: none; }
        .section[data-tab].visible { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="navigator.html" class="back-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
                Back to Navigator
            </a>
            <h1 style="margin-top: 16px">Screen <span>Gallery</span></h1>
            <p class="subtitle">Live previews of every screen in Goal Ninja</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="showTab('onboarding')">Onboarding Flow</button>
            <button class="tab-btn" onclick="showTab('app')">App Screens</button>
            <button class="tab-btn" onclick="showTab('other')">Other Pages</button>
        </div>

        <!-- ==================== ONBOARDING FLOW ==================== -->
        <div class="section visible" data-tab="onboarding">
            <div class="section-header">
                <div class="section-title">Onboarding Flow</div>
                <span class="screen-count">14</span>
                <div class="flow-line">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
                    Screens shown in order
                </div>
            </div>
            <div class="screens-grid" id="onboardingGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- ==================== APP SCREENS ==================== -->
        <div class="section" data-tab="app">
            <div class="section-header">
                <div class="section-title">App Screens</div>
                <span class="screen-count">11</span>
            </div>
            <div class="screens-grid" id="appGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- ==================== OTHER PAGES ==================== -->
        <div class="section" data-tab="other">
            <div class="section-header">
                <div class="section-title">Other Pages</div>
                <span class="screen-count">5</span>
            </div>
            <div class="screens-grid" id="otherGrid">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <script>
    // ============================
    // SCREEN DATA
    // ============================
    var onboardingScreens = [
        { idx: 0,  name: 'Social Proof',    desc: 'Build habits, grow your savings' },
        { idx: 1,  name: 'Welcome',         desc: 'Meet your accountability buddy' },
        { idx: 2,  name: 'Name',            desc: 'Personalize the experience' },
        { idx: 3,  name: 'How It Works',    desc: 'Create → Check in → Unlock' },
        { idx: 4,  name: 'Experience',       desc: 'Habit tracking background' },
        { idx: 5,  name: 'Pain Points',     desc: 'What usually gets in the way' },
        { idx: 6,  name: 'Goal Area',       desc: 'Pick your focus category' },
        { idx: 7,  name: 'Plan',            desc: 'Your personalized plan' },
        { idx: 8,  name: 'Customize Goal',  desc: 'Set up habits, duration & stakes' },
        { idx: 9,  name: 'Commitment',      desc: 'Make it official' },
        { idx: 10, name: 'Analytics Teaser', desc: 'Track your progress (Pro preview)' },
        { idx: 11, name: 'Payment',         desc: 'Enable accountability with stakes' },
        { idx: 12, name: 'Success',         desc: "You're all set!" },
        { idx: 13, name: 'Quick Win',       desc: 'First habit check-ins' }
    ];

    var appScreens = [
        { file: 'goal-effect-home.html',              name: 'Home',            desc: "Today's habits & daily overview" },
        { file: 'goal-effect-goals-list.html',        name: 'Goals',           desc: 'All active & completed goals' },
        { file: 'goal-effect-habits-list.html',       name: 'Habits',          desc: 'All habits with check-in tracking' },
        { file: 'goal-effect-savings.html',           name: 'Savings',         desc: 'Savings vault & goal breakdown' },
        { file: 'goal-effect-analytics.html',         name: 'Analytics',       desc: 'Charts, patterns & insights' },
        { file: 'goal-effect-leaderboard.html',       name: 'Leaderboard',     desc: 'Dojo rankings & community' },
        { file: 'goal-effect-profile.html',           name: 'Profile',         desc: 'Account & settings' },
        { file: 'goal-effect-goal-detail.html',       name: 'Goal Detail',     desc: 'Individual goal progress' },
        { file: 'goal-effect-create-from-template.html', name: 'Create Goal', desc: 'Configure a new goal' },
        { file: 'goal-effect-activity.html',          name: 'Activity',        desc: 'Check-in history & streaks' },
        { file: 'goal-effect-templates.html',         name: 'Templates',       desc: 'Browse goal templates' }
    ];

    var otherPages = [
        { file: 'goal-effect-landing.html',        name: 'Landing Page',       desc: 'Marketing & app pitch' },
        { file: 'goal-effect-elite-upgrade.html',  name: 'Elite Upgrade',      desc: 'Free vs Elite comparison' },
        { file: 'goal-effect-subscription.html',   name: 'Subscription',       desc: 'Ninja Elite upgrade' },
        { file: 'goal-effect-savings-lock.html',   name: 'How Savings Work',   desc: 'Savings lock explainer' },
        { file: 'goal-effect-pro-paywall.html',    name: 'Pro Paywall',        desc: 'Subscription upgrade with pricing' }
    ];

    // ============================
    // BUILD GRIDS
    // ============================
    function createPhoneCard(src, number, name, desc, link) {
        var card = document.createElement('a');
        card.className = 'screen-card';
        card.href = link || '#';
        if (link) card.target = '_blank';

        card.innerHTML =
            '<div class="phone-frame" data-src="' + src + '">' +
            '</div>' +
            '<div class="screen-label">' +
                (number !== null ? '<div class="screen-number">Screen ' + (number + 1) + '</div>' : '') +
                '<div class="screen-name">' + name + '</div>' +
                '<div class="screen-desc">' + desc + '</div>' +
            '</div>';

        return card;
    }

    // Build onboarding grid
    var onbGrid = document.getElementById('onboardingGrid');
    onboardingScreens.forEach(function(s) {
        var src = 'goal-effect-onboarding.html?preview=1&screen=' + s.idx;
        var card = createPhoneCard(src, s.idx, s.name, s.desc, 'goal-effect-onboarding.html?preview=1');
        onbGrid.appendChild(card);
    });

    // Build app grid
    var appGrid = document.getElementById('appGrid');
    appScreens.forEach(function(s) {
        var card = createPhoneCard(s.file, null, s.name, s.desc, s.file);
        appGrid.appendChild(card);
    });

    // Build other grid
    var otherGrid = document.getElementById('otherGrid');
    otherPages.forEach(function(s) {
        var card = createPhoneCard(s.file, null, s.name, s.desc, s.file);
        otherGrid.appendChild(card);
    });

    // ============================
    // LAZY LOAD IFRAMES
    // ============================
    function loadIframes() {
        var frames = document.querySelectorAll('.phone-frame[data-src]');
        frames.forEach(function(frame) {
            // Only load if visible section
            var section = frame.closest('.section');
            if (!section || !section.classList.contains('visible')) return;

            // Check if already loaded
            if (frame.querySelector('iframe')) return;

            var rect = frame.getBoundingClientRect();
            var inView = rect.top < window.innerHeight + 600 && rect.bottom > -200;

            if (inView) {
                var src = frame.getAttribute('data-src');
                var iframe = document.createElement('iframe');
                iframe.src = src;
                iframe.setAttribute('loading', 'lazy');
                iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin');

                // Calculate scale to fit
                var frameWidth = frame.offsetWidth;
                var scale = frameWidth / 390;
                iframe.style.transform = 'scale(' + scale + ')';

                iframe.onload = function() {
                    frame.classList.add('loaded');
                    // Try to scroll to specific onboarding screen
                    try {
                        var url = new URL(iframe.src, window.location.href);
                        var screenIdx = url.searchParams.get('screen');
                        if (screenIdx !== null) {
                            iframe.contentWindow.postMessage({ type: 'goToScreen', index: parseInt(screenIdx) }, '*');
                        }
                    } catch(e) {}
                };

                frame.appendChild(iframe);
                frame.removeAttribute('data-src');
            }
        });
    }

    // Throttle scroll handler
    var scrollTimer;
    window.addEventListener('scroll', function() {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(loadIframes, 100);
    });

    // Handle window resize (recalculate iframe scale)
    window.addEventListener('resize', function() {
        document.querySelectorAll('.phone-frame iframe').forEach(function(iframe) {
            var frameWidth = iframe.parentElement.offsetWidth;
            var scale = frameWidth / 390;
            iframe.style.transform = 'scale(' + scale + ')';
        });
    });

    // ============================
    // TAB NAVIGATION
    // ============================
    function showTab(tabName) {
        // Update buttons
        document.querySelectorAll('.tab-btn').forEach(function(btn) {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        // Show/hide sections
        document.querySelectorAll('.section[data-tab]').forEach(function(section) {
            if (section.getAttribute('data-tab') === tabName) {
                section.classList.add('visible');
            } else {
                section.classList.remove('visible');
            }
        });

        // Load iframes for newly visible section
        setTimeout(loadIframes, 50);
    }

    // ============================
    // LISTEN FOR SCREEN NAV IN ONBOARDING
    // ============================
    // The onboarding page will listen for postMessage to navigate to a screen
    // We inject a small script via the iframe URL hash

    // Initial load
    setTimeout(loadIframes, 300);

    // Service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('../sw.js');
    }
    </script>
</body>
</html>
